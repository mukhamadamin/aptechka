import AsyncStorage from "@react-native-async-storage/async-storage";
import * as React from "react";

export type AppLanguage = "ru" | "en";

const KEY = "home_pharmacy_lang_v1";

type Dictionary = Record<string, string>;

const ru: Dictionary = {
  "common.ok": "Ок",
  "common.cancel": "Отмена",
  "common.delete": "Удалить",
  "common.error": "Ошибка",
  "common.loading": "Загрузка",

  "drawer.home.title": "Лекарства",
  "drawer.home.label": "Главная",
  "drawer.family.title": "Семья",
  "drawer.family.label": "Члены семьи",
  "drawer.assistant.title": "Помощник",
  "drawer.assistant.label": "Помощник",
  "drawer.shopping.title": "Покупки",
  "drawer.shopping.label": "Список покупок",
  "drawer.profile.title": "Профиль",
  "drawer.profile.label": "Профиль",
  "drawer.settings.title": "Настройки",
  "drawer.settings.label": "Настройки",
  "drawer.medicine.new": "Добавить лекарство",
  "drawer.medicine.edit": "Редактирование",

  "auth.title": "Домашняя аптечка",
  "auth.subtitle": "Войдите, чтобы хранить и синхронизировать данные в Firebase.",
  "auth.login": "Вход",
  "auth.register": "Регистрация",
  "auth.name": "Имя",
  "auth.namePlaceholder": "Например: Олег",
  "auth.password": "Пароль",
  "auth.passwordPlaceholder": "Минимум 6 символов",
  "auth.passwordInvalid": "Пароль должен быть не короче 6 символов.",
  "auth.signIn": "Войти",
  "auth.create": "Создать аккаунт",
  "auth.invalid": "Введите корректный email и пароль минимум из 6 символов.",
  "auth.nameInvalid": "Имя должно содержать минимум 2 символа.",
  "auth.requestFailed": "Не удалось выполнить запрос.",
  "auth.checkInput": "Проверьте данные",
  "auth.notAuthorized": "Сессия недействительна. Войдите снова.",
  "auth.reloginRequired": "Для смены пароля нужно заново войти в аккаунт.",

  "settings.title": "Настройки",
  "settings.subtitle": "Управление темой, языком и семейным доступом.",
  "settings.theme.dark": "Тёмная",
  "settings.theme.darkDesc": "Контрастная и спокойная.",
  "settings.theme.light": "Светлая",
  "settings.theme.lightDesc": "Более светлая и нейтральная.",
  "settings.lang.title": "Язык интерфейса",
  "settings.lang.ru": "Русский",
  "settings.lang.en": "English",
  "settings.sos.title": "SOS-кнопка",
  "settings.sos.toggle": "Показывать SOS в шторке уведомлений",
  "settings.sos.hint": "Быстрый звонок экстренному контакту из верхней шторки телефона.",
  "settings.sos.permissionDenied": "Разрешите уведомления, чтобы включить SOS в шторке.",
  "settings.widget.title": "Виджет",
  "settings.widget.hint": "Добавьте виджет с приёмом лекарств на главный экран.",
  "settings.widget.pinButton": "Показать на главном экране",
  "settings.widget.pinRequested": "Подтвердите добавление виджета на главном экране.",
  "settings.widget.unavailable": "Эта функция доступна только в Android-сборке приложения.",
  "settings.widget.unsupported": "Лаунчер не поддерживает мгновенное добавление виджета.",
  "settings.household.title": "Семья",
  "settings.household.current": "Текущий код: {code}",
  "settings.household.notLoaded": "не загружен",
  "settings.household.create": "Создать семью",
  "settings.household.join": "Присоединиться по коду",
  "settings.household.placeholder": "Введите код семьи",
  "settings.household.invalid": "Введите корректный код семьи.",
  "settings.household.joined": "Вы присоединились к семье {code}.",
  "settings.household.created": "Ваш код семьи: {code}.",
  "settings.household.createFail": "Не удалось создать семью.",
  "settings.household.joinFail": "Не удалось присоединиться к семье.",
  "settings.signout": "Выйти",
  "settings.signoutFail": "Не удалось выйти из аккаунта.",

  "family.title": "Члены семьи",
  "family.subtitle": "Это реальные аккаунты приложения с общей семейной базой.",
  "family.empty.noHousehold": "Семья не подключена",
  "family.empty.noHouseholdText": "Откройте настройки и присоединитесь к семье по коду.",
  "family.empty.none": "Пользователи не найдены",
  "family.empty.noneText": "Попросите родственников зарегистрироваться и ввести тот же код семьи.",
  "family.loadingText": "Загружаем участников семьи.",
  "family.unnamed": "Пользователь без имени",
  "family.noEmail": "Email не указан",
  "family.you": "Вы",
  "family.owner": "Глава семьи",
  "family.memberCreate.title": "Добавление члена семьи",
  "family.memberCreate.subtitleOwner": "Создайте аккаунт родственника и он сразу попадет в вашу семью.",
  "family.memberCreate.subtitleNotOwner": "Добавлять новых участников может только глава семьи.",
  "family.memberCreate.action": "Создать аккаунт участника",
  "family.memberCreate.success": "Аккаунт {email} создан и добавлен в семью.",
  "family.memberCreate.failed": "Не удалось создать аккаунт участника.",
  "family.memberCreate.invalidInput": "Введите корректный email и пароль минимум из 6 символов.",
  "family.memberCreate.nameInvalid": "Имя должно содержать минимум 2 символа.",
  "family.memberCreate.ownerOnly": "Только глава семьи может создавать новые аккаунты.",
  "family.memberCreate.householdNotFound": "Семья не найдена.",
  "family.memberCreate.emailInUse": "Этот email уже используется.",
  "family.memberCreate.invalidEmail": "Некорректный email.",
  "family.memberCreate.weakPassword": "Слишком простой пароль. Используйте не менее 6 символов.",

  "home.title": "Домашняя аптечка",
  "home.subtitle": "Общая база данных для вашей семьи.",
  "home.searchPlaceholder": "Поиск по названию, дозировке, стране или заметкам",
  "home.filter": "Фильтр",
  "home.add": "Добавить лекарство",
  "home.filter.all": "Все",
  "home.filter.expiring": "Истекают (<= 7 дней)",
  "home.filter.expired": "Просроченные",
  "home.filter.noExpiry": "Без срока",
  "home.filter.withNotes": "С заметками",
  "home.empty.noHousehold": "Семья не подключена",
  "home.empty.noHouseholdText": "Откройте настройки и присоединитесь к семье по коду.",
  "home.empty.list": "Список пуст",
  "home.empty.query": "Измените запрос или фильтр.",
  "home.empty.first": "Добавьте первое лекарство.",
  "home.loadingText": "Подготавливаем общий список.",
  "home.delete.title": "Удалить лекарство",
  "home.delete.text": "Действие нельзя отменить.",
  "home.qty": "Кол-во: {value}",
  "home.country": "Страна: {value}",
  "home.dosage": "Дозировка: {value}",
  "home.expired": "Просрочено - {date}",
  "home.expiresToday": "Истекает сегодня - {date}",
  "home.expiresIn": "Истекает через {days} дн. - {date}",
  "home.expiry": "Срок: {date}",
  "home.stock.low": "Заканчивается",
  "home.stock.empty": "Закончилось",
  "home.useOne": "Списать 1 единицу",
  "home.useOneErrorTitle": "Не удалось списать",
  "home.useOneErrorText": "Поле «Количество» должно содержать число (например: 20 табл., 100 мл или 50 г).",
  "home.collapse": "Нажмите ещё раз, чтобы свернуть.",

  "medicine.title.new": "Новое лекарство",
  "medicine.title.edit": "Редактирование лекарства",
  "medicine.subtitle": "Заполните форму и сохраните препарат в семейную аптечку.",
  "medicine.noHousehold": "Семья не подключена",
  "medicine.noHouseholdText": "Сначала присоединитесь к семье в настройках.",
  "medicine.notFound": "Лекарство не найдено или было удалено.",
  "medicine.name": "Название",
  "medicine.namePlaceholder": "Например: Парацетамол",
  "medicine.form": "Форма препарата",
  "medicine.form.tablet": "Таблетки",
  "medicine.form.capsule": "Капсулы",
  "medicine.form.liquid": "Жидкое",
  "medicine.form.powder": "Порошок",
  "medicine.form.other": "Другое",
  "medicine.country": "Страна производитель",
  "medicine.countryPlaceholder": "Например: Германия",
  "medicine.barcode": "Штрихкод",
  "medicine.barcodePlaceholder": "Например: 4601234567890",
  "medicine.scan": "Сканировать штрихкод",
  "medicine.scanClose": "Закрыть сканер",
  "medicine.scanDone": "Штрихкод считан: {code}",
  "medicine.cameraDenied": "Разрешите доступ к камере, чтобы сканировать штрихкод.",
  "medicine.noAccess": "Нет доступа",
  "medicine.dosage": "Дозировка",
  "medicine.dosagePlaceholder": "Например: 500 мг",
  "medicine.quantity": "Количество",
  "medicine.quantityPlaceholder": "Например: 20",
  "medicine.unit": "Единица количества",
  "medicine.unit.pcs": "шт",
  "medicine.unit.ml": "мл",
  "medicine.unit.g": "г",
  "medicine.intake": "Напоминания о приёме",
  "medicine.intakePlaceholder": "Например: 08:00,20:00",
  "medicine.intakeHint": "Укажите время через запятую в формате ЧЧ:ММ.",
  "medicine.intakeMembers": "Кому принимать",
  "medicine.intakeMembersHint": "Если никого не выбрать, напоминание считается общим.",
  "medicine.intakeMembersByTime": "Кто принимает в это время",
  "medicine.intakeMembersByTimeHint": "Сначала укажите время приёма выше.",
  "medicine.intakeTimeSlot": "В {time}",
  "medicine.expiry": "Срок годности",
  "medicine.expiryUnset": "Не указан",
  "medicine.pickDate": "Нажмите, чтобы выбрать дату",
  "medicine.clearDate": "Сбросить срок годности",
  "medicine.remindDays": "Напомнить за (дней)",
  "medicine.remindDaysPlaceholder": "Например: 7",
  "medicine.notes": "Заметки",
  "medicine.notesPlaceholder": "Например: после еды",
  "medicine.saveNew": "Добавить лекарство",
  "medicine.saveEdit": "Сохранить изменения",
  "medicine.nameFromBarcode": "Лекарство {code}",

  "notifications.expiryChannel": "Срок годности",
  "notifications.expirySoonTitle": "Срок годности скоро закончится",
  "notifications.expirySoonBody": "{name} - осталось {days} дн.",
  "notifications.expiryTodayTitle": "Срок годности сегодня",
  "notifications.expiryTodayBody": "{name} - проверьте препарат.",
  "notifications.intakeTitle": "Напоминание о приёме",
  "notifications.intakeBody": "{name} - время принять препарат.",

  "validation.medicineName": "Введите название лекарства (минимум 2 символа).",
  "household.codeNotFound": "Код семьи не найден.",

  "assistant.title": "Универсальный помощник семьи",
  "assistant.subtitle": "Экстренная карточка, список покупок и быстрые действия в одном месте.",
  "assistant.metrics.total": "Всего: {count}",
  "assistant.metrics.expiring": "Истекают ≤14 дн: {count}",
  "assistant.metrics.expired": "Просрочено: {count}",
  "assistant.metrics.low": "Заканчиваются: {count}",
  "assistant.shopping.title": "Семейный список покупок",
  "assistant.shopping.subtitle": "Общий чеклист для пополнения домашней аптечки.",
  "assistant.shopping.generate": "Автозаполнение",
  "assistant.shopping.namePlaceholder": "Что купить",
  "assistant.shopping.qtyPlaceholder": "Кол-во",
  "assistant.shopping.add": "Добавить в список",
  "assistant.shopping.empty": "Список покупок пуст.",
  "assistant.shopping.invalid": "Введите название минимум из 2 символов.",
  "assistant.shopping.generated": "Добавлено {count} позиций в список покупок.",
  "assistant.shopping.generatedEmpty": "Новые позиции для автозаполнения не найдены.",
  "assistant.emergency.title": "Экстренная карточка (SOS)",
  "assistant.emergency.subtitle": "Сохраните важные данные, доступные всей семье.",
  "assistant.emergency.contactName": "Контакт для экстренного случая",
  "assistant.emergency.contactPhone": "Телефон экстренного контакта",
  "assistant.emergency.blood": "Группа крови",
  "assistant.emergency.allergies": "Аллергии",
  "assistant.emergency.conditions": "Хронические состояния",
  "assistant.emergency.address": "Адрес",
  "assistant.emergency.notes": "Дополнительные заметки",
  "assistant.emergency.save": "Сохранить карточку",
  "assistant.emergency.saved": "Экстренная карточка сохранена.",
  "assistant.emergency.call": "Позвонить экстренному контакту",
  "assistant.emergency.noPhoneTitle": "Телефон не указан",
  "assistant.emergency.noPhoneText": "Добавьте номер экстренного контакта, чтобы звонить в один тап.",
  "assistant.error.saveProfile": "Не удалось сохранить карточку.",
  "profile.title": "Профиль",
  "profile.subtitle": "Ваши личные данные и экстренная медицинская карточка.",
  "profile.newPassword": "Новый пароль",
  "profile.repeatPassword": "Повторите пароль",
  "profile.passwordMismatch": "Пароли не совпадают.",
  "profile.passwordWidgetTitle": "Смена пароля",
  "profile.passwordWidgetSubtitle": "Отдельно обновите пароль аккаунта.",
  "profile.changePassword": "Сменить пароль",
  "profile.passwordChanged": "Пароль обновлен.",
  "assistant.firstAid.title": "Быстрая первая помощь",
  "assistant.firstAid.subtitle": "Короткие инструкции до обращения к врачу.",
  "assistant.firstAid.burn.title": "Ожог",
  "assistant.firstAid.burn.text": "Охладите место ожога прохладной водой 10-20 минут. Не вскрывайте пузыри и не наносите масло.",
  "assistant.firstAid.allergy.title": "Острая аллергия",
  "assistant.firstAid.allergy.text": "Прекратите контакт с аллергеном, дайте антигистаминный препарат и наблюдайте дыхание. При ухудшении звоните 112.",
  "assistant.firstAid.fever.title": "Высокая температура",
  "assistant.firstAid.fever.text": "Контролируйте температуру каждые 4-6 часов, обеспечьте питьё и используйте жаропонижающее по инструкции.",
};

const en: Dictionary = {
  "common.ok": "OK",
  "common.cancel": "Cancel",
  "common.delete": "Delete",
  "common.error": "Error",
  "common.loading": "Loading",

  "drawer.home.title": "Medicines",
  "drawer.home.label": "Home",
  "drawer.family.title": "Family",
  "drawer.family.label": "Family Members",
  "drawer.assistant.title": "Assistant",
  "drawer.assistant.label": "Assistant",
  "drawer.shopping.title": "Shopping",
  "drawer.shopping.label": "Shopping List",
  "drawer.profile.title": "Profile",
  "drawer.profile.label": "Profile",
  "drawer.settings.title": "Settings",
  "drawer.settings.label": "Settings",
  "drawer.medicine.new": "Add Medicine",
  "drawer.medicine.edit": "Edit Medicine",

  "auth.title": "Home Aid Kit",
  "auth.subtitle": "Sign in to store and sync your data with Firebase.",
  "auth.login": "Sign In",
  "auth.register": "Register",
  "auth.name": "Name",
  "auth.namePlaceholder": "For example: Anna",
  "auth.password": "Password",
  "auth.passwordPlaceholder": "At least 6 characters",
  "auth.passwordInvalid": "Password must be at least 6 characters.",
  "auth.signIn": "Sign In",
  "auth.create": "Create Account",
  "auth.invalid": "Enter a valid email and a password with at least 6 characters.",
  "auth.nameInvalid": "Name must be at least 2 characters.",
  "auth.requestFailed": "Request failed.",
  "auth.checkInput": "Check your input",
  "auth.notAuthorized": "Session is invalid. Please sign in again.",
  "auth.reloginRequired": "Please sign in again before changing password.",

  "settings.title": "Settings",
  "settings.subtitle": "Manage theme, language and household sharing.",
  "settings.theme.dark": "Dark",
  "settings.theme.darkDesc": "High contrast and calm.",
  "settings.theme.light": "Light",
  "settings.theme.lightDesc": "Brighter and neutral.",
  "settings.lang.title": "Interface language",
  "settings.lang.ru": "Русский",
  "settings.lang.en": "English",
  "settings.sos.title": "SOS button",
  "settings.sos.toggle": "Show SOS in notification shade",
  "settings.sos.hint": "Quick call to emergency contact from phone notification shade.",
  "settings.sos.permissionDenied": "Allow notifications to enable SOS in the shade.",
  "settings.widget.title": "Widget",
  "settings.widget.hint": "Add the medicine schedule widget to your home screen.",
  "settings.widget.pinButton": "Show on home screen",
  "settings.widget.pinRequested": "Confirm adding the widget on your home screen.",
  "settings.widget.unavailable": "This feature is available only in the Android app build.",
  "settings.widget.unsupported": "Your launcher does not support instant widget pinning.",
  "settings.household.title": "Household",
  "settings.household.current": "Current code: {code}",
  "settings.household.notLoaded": "not loaded",
  "settings.household.create": "Create Household",
  "settings.household.join": "Join by Code",
  "settings.household.placeholder": "Enter household code",
  "settings.household.invalid": "Enter a valid household code.",
  "settings.household.joined": "You joined household {code}.",
  "settings.household.created": "Your household code: {code}.",
  "settings.household.createFail": "Failed to create household.",
  "settings.household.joinFail": "Failed to join household.",
  "settings.signout": "Sign Out",
  "settings.signoutFail": "Failed to sign out.",

  "family.title": "Family Members",
  "family.subtitle": "These are real app accounts sharing one household database.",
  "family.empty.noHousehold": "No household connected",
  "family.empty.noHouseholdText": "Open settings and join household by code.",
  "family.empty.none": "No users found",
  "family.empty.noneText": "Ask relatives to register and use the same household code.",
  "family.loadingText": "Loading members.",
  "family.unnamed": "Unnamed user",
  "family.noEmail": "No email",
  "family.you": "You",
  "family.owner": "Owner",
  "family.memberCreate.title": "Add family member",
  "family.memberCreate.subtitleOwner": "Create a relative account and it will be linked to this household immediately.",
  "family.memberCreate.subtitleNotOwner": "Only the household owner can add new members.",
  "family.memberCreate.action": "Create member account",
  "family.memberCreate.success": "Account {email} was created and added to household.",
  "family.memberCreate.failed": "Failed to create member account.",
  "family.memberCreate.invalidInput": "Enter a valid email and password with at least 6 characters.",
  "family.memberCreate.nameInvalid": "Name must be at least 2 characters.",
  "family.memberCreate.ownerOnly": "Only the household owner can create new accounts.",
  "family.memberCreate.householdNotFound": "Household not found.",
  "family.memberCreate.emailInUse": "This email is already in use.",
  "family.memberCreate.invalidEmail": "Invalid email address.",
  "family.memberCreate.weakPassword": "Password is too weak. Use at least 6 characters.",

  "home.title": "Home Medicine Kit",
  "home.subtitle": "Shared database for your family.",
  "home.searchPlaceholder": "Search by name, dosage, country or notes",
  "home.filter": "Filter",
  "home.add": "Add Medicine",
  "home.filter.all": "All",
  "home.filter.expiring": "Expiring (<= 7 days)",
  "home.filter.expired": "Expired",
  "home.filter.noExpiry": "No Expiry",
  "home.filter.withNotes": "With Notes",
  "home.empty.noHousehold": "No household connected",
  "home.empty.noHouseholdText": "Open settings and join household by code.",
  "home.empty.list": "List is empty",
  "home.empty.query": "Change search or filter.",
  "home.empty.first": "Add your first medicine.",
  "home.loadingText": "Preparing shared list.",
  "home.delete.title": "Delete medicine",
  "home.delete.text": "This action cannot be undone.",
  "home.qty": "Qty: {value}",
  "home.country": "Country: {value}",
  "home.dosage": "Dosage: {value}",
  "home.expired": "Expired - {date}",
  "home.expiresToday": "Expires today - {date}",
  "home.expiresIn": "Expires in {days} days - {date}",
  "home.expiry": "Expiry: {date}",
  "home.stock.low": "Running low",
  "home.stock.empty": "Out of stock",
  "home.useOne": "Use 1 unit",
  "home.useOneErrorTitle": "Cannot decrement",
  "home.useOneErrorText": "Quantity must contain a number (e.g. 20 tabs, 100 ml, 50 g).",
  "home.collapse": "Tap again to collapse.",

  "medicine.title.new": "New medicine",
  "medicine.title.edit": "Edit medicine",
  "medicine.subtitle": "Fill in details and save to your shared kit.",
  "medicine.noHousehold": "No household connected",
  "medicine.noHouseholdText": "Join a household in settings first.",
  "medicine.notFound": "Medicine not found or already deleted.",
  "medicine.name": "Name",
  "medicine.namePlaceholder": "For example: Paracetamol",
  "medicine.form": "Dosage form",
  "medicine.form.tablet": "Tablets",
  "medicine.form.capsule": "Capsules",
  "medicine.form.liquid": "Liquid",
  "medicine.form.powder": "Powder",
  "medicine.form.other": "Other",
  "medicine.country": "Country of origin",
  "medicine.countryPlaceholder": "For example: Germany",
  "medicine.barcode": "Barcode",
  "medicine.barcodePlaceholder": "For example: 4601234567890",
  "medicine.scan": "Scan barcode",
  "medicine.scanClose": "Close scanner",
  "medicine.scanDone": "Scanned barcode: {code}",
  "medicine.cameraDenied": "Allow camera access to scan barcode.",
  "medicine.noAccess": "No access",
  "medicine.dosage": "Dosage",
  "medicine.dosagePlaceholder": "For example: 500 mg",
  "medicine.quantity": "Quantity",
  "medicine.quantityPlaceholder": "For example: 20",
  "medicine.unit": "Quantity unit",
  "medicine.unit.pcs": "pcs",
  "medicine.unit.ml": "ml",
  "medicine.unit.g": "g",
  "medicine.intake": "Intake reminders",
  "medicine.intakePlaceholder": "For example: 08:00,20:00",
  "medicine.intakeHint": "Enter times separated by commas in HH:MM format.",
  "medicine.intakeMembers": "Who should take",
  "medicine.intakeMembersHint": "If nobody is selected, this reminder is treated as shared.",
  "medicine.intakeMembersByTime": "Who takes at this time",
  "medicine.intakeMembersByTimeHint": "Set intake times above first.",
  "medicine.intakeTimeSlot": "At {time}",
  "medicine.expiry": "Expiry date",
  "medicine.expiryUnset": "Not set",
  "medicine.pickDate": "Tap to select date",
  "medicine.clearDate": "Clear expiry date",
  "medicine.remindDays": "Remind before (days)",
  "medicine.remindDaysPlaceholder": "For example: 7",
  "medicine.notes": "Notes",
  "medicine.notesPlaceholder": "For example: after meal",
  "medicine.saveNew": "Add medicine",
  "medicine.saveEdit": "Save changes",
  "medicine.nameFromBarcode": "Medicine {code}",

  "notifications.expiryChannel": "Expiry date",
  "notifications.expirySoonTitle": "Expiry date is coming",
  "notifications.expirySoonBody": "{name} - {days} day(s) left.",
  "notifications.expiryTodayTitle": "Expires today",
  "notifications.expiryTodayBody": "{name} - please check this medicine.",
  "notifications.intakeTitle": "Intake reminder",
  "notifications.intakeBody": "{name} - time to take medicine.",

  "validation.medicineName": "Enter medicine name (at least 2 chars).",
  "household.codeNotFound": "Household code not found.",

  "assistant.title": "Universal Family Assistant",
  "assistant.subtitle": "Emergency card, shopping list and quick actions in one place.",
  "assistant.metrics.total": "Total: {count}",
  "assistant.metrics.expiring": "Expiring ≤14 days: {count}",
  "assistant.metrics.expired": "Expired: {count}",
  "assistant.metrics.low": "Running low: {count}",
  "assistant.shopping.title": "Shared Shopping List",
  "assistant.shopping.subtitle": "A family checklist to restock your home medicine kit.",
  "assistant.shopping.generate": "Auto-fill",
  "assistant.shopping.namePlaceholder": "What to buy",
  "assistant.shopping.qtyPlaceholder": "Qty",
  "assistant.shopping.add": "Add to list",
  "assistant.shopping.empty": "Shopping list is empty.",
  "assistant.shopping.invalid": "Enter a name with at least 2 characters.",
  "assistant.shopping.generated": "Added {count} items to shopping list.",
  "assistant.shopping.generatedEmpty": "No new items found for auto-fill.",
  "assistant.emergency.title": "Emergency Card (SOS)",
  "assistant.emergency.subtitle": "Store critical details shared with your household.",
  "assistant.emergency.contactName": "Emergency contact name",
  "assistant.emergency.contactPhone": "Emergency contact phone",
  "assistant.emergency.blood": "Blood type",
  "assistant.emergency.allergies": "Allergies",
  "assistant.emergency.conditions": "Chronic conditions",
  "assistant.emergency.address": "Address",
  "assistant.emergency.notes": "Additional notes",
  "assistant.emergency.save": "Save card",
  "assistant.emergency.saved": "Emergency card saved.",
  "assistant.emergency.call": "Call emergency contact",
  "assistant.emergency.noPhoneTitle": "Phone is missing",
  "assistant.emergency.noPhoneText": "Add emergency phone number to call in one tap.",
  "assistant.error.saveProfile": "Failed to save emergency card.",
  "profile.title": "Profile",
  "profile.subtitle": "Your personal details and emergency medical card.",
  "profile.newPassword": "New password",
  "profile.repeatPassword": "Repeat password",
  "profile.passwordMismatch": "Passwords do not match.",
  "profile.passwordWidgetTitle": "Change password",
  "profile.passwordWidgetSubtitle": "Update account password in a separate section.",
  "profile.changePassword": "Change password",
  "profile.passwordChanged": "Password updated.",
  "assistant.firstAid.title": "Quick First Aid",
  "assistant.firstAid.subtitle": "Short instructions before professional help.",
  "assistant.firstAid.burn.title": "Burn",
  "assistant.firstAid.burn.text": "Cool the burn with running water for 10-20 minutes. Do not break blisters or apply oil.",
  "assistant.firstAid.allergy.title": "Acute allergy",
  "assistant.firstAid.allergy.text": "Stop allergen exposure, take antihistamine and monitor breathing. Call emergency services if symptoms worsen.",
  "assistant.firstAid.fever.title": "High fever",
  "assistant.firstAid.fever.text": "Check temperature every 4-6 hours, keep hydration and use antipyretics according to instructions.",
};

const dictionaries: Record<AppLanguage, Dictionary> = { ru, en };

type LanguageContextValue = {
  language: AppLanguage;
  setLanguage: (next: AppLanguage) => void;
  t: (key: string, vars?: Record<string, string | number>) => string;
  hydrated: boolean;
};

const LanguageContext = React.createContext<LanguageContextValue | null>(null);

export function LanguageProvider({ children }: { children: React.ReactNode }) {
  const [language, setLanguageState] = React.useState<AppLanguage>("ru");
  const [hydrated, setHydrated] = React.useState(false);

  React.useEffect(() => {
    (async () => {
      const saved = await AsyncStorage.getItem(KEY);
      if (saved === "ru" || saved === "en") {
        setLanguageState(saved);
      }
      setHydrated(true);
    })();
  }, []);

  const setLanguage = React.useCallback((next: AppLanguage) => {
    setLanguageState(next);
    AsyncStorage.setItem(KEY, next).catch(() => {});
  }, []);

  const t = React.useCallback(
    (key: string, vars?: Record<string, string | number>) => {
      const base = dictionaries[language][key] ?? key;
      if (!vars) return base;

      return Object.entries(vars).reduce(
        (acc, [name, value]) => acc.replace(new RegExp(`\\{${name}\\}`, "g"), String(value)),
        base
      );
    },
    [language]
  );

  const value = React.useMemo(
    () => ({ language, setLanguage, t, hydrated }),
    [language, setLanguage, t, hydrated]
  );

  return <LanguageContext.Provider value={value}>{children}</LanguageContext.Provider>;
}

export function useLanguage() {
  const ctx = React.useContext(LanguageContext);
  if (!ctx) throw new Error("useLanguage must be used inside LanguageProvider");
  return ctx;
}

